---
layout: post
title: 유저업데이트
category: Django
tags: [python, Django]
comments: python
---

# 만약 로그인 안한 유저가 업데이트를 눌렀을 경우에

- mixin으로 처리하면 된다.

- 로그인 세션은 어떻게 관리되지? "내가 나"임을 증명할 수 있는 세션은 어떻게 관리될까

- get_object로 미리 관리함.

```python
    def get_object(self, queryset=None):
        room = super().get_object(queryset=queryset)
        if room.host.pk != self.request.user.pk:
            raise Http404()
        return room
```

# 방 사진 삭제

- room/room_photos.html에 방 사진 리스트들이 나열되어있다. 사진마다 방(room_pk)과 사진리스트(photos_pk)가 있어야 한다.

- 삭제 버튼을 클릭했을 시에 해당 방에 대해서 사진이 삭제되어야 한다.

### 삭제 버튼을 클릭했다면

- 1. 방의 소유주여야한다.

- 2. 삭제를 클릭했을 때, 원 위치로 돌아가야 한다.

| 기능 | URL | Views | Template |
|---|:---:|---:|---:|
| 방 사진 수정 리스트(room.edit) | rooms/<int:pk>/edit | RoomPhotosView(DetailView) | rooms/room_edit |
| 방 삭제(room.delete) | <int:room_pk>/photos/<int:photo_pk>/delete/ | photodelete() | REDIRECT |
| 방삭제 리다이렉트 | rooms:photos | RoomPhotosView(DetailView) | rooms/room_photos.html |

```python
@login_required
def delete_photo(request, room_pk, photo_pk):
    user = request.user
    try:
        room = models.Room.objects.get(pk=room_pk)
        # 빙의 주인이 아닐 경우
        if room.host.pk != user.pk:
            messages.error(request, "Cant delete that photo")
        else:
        # rooms:photos를 삭제한다.
            models.Photo.objects.filter(pk=photo_pk).delete()
            messages.success(request, "Photo Deleted")
        return redirect(reverse("rooms:photos", kwargs={"pk": room_pk}))
    except models.Room.DoesNotExist:
        # 방이 없을 경우에 홈으로 돌아간다.
        return redirect(reverse("core:home"))
```


# 방 업데이트

- 1. 방의 소유주여야한다.

- 2. 방의 정보를 READ로 가져와야한다.


| 기능 | URL | Views | Template |
|---|:---:|---:|---:|
| 방 사진수정(room.edit) | rooms/<int:pk>/edit | RoomPhotosView(DetailView) | rooms/room_edit |
| 방 사진 수정(room.edit-photo) | <int:room_pk>/photos/<int:photo_pk>/edit/ | EditPhotoView | rooms/photo_edit.html |
| 방 수정 리다이렉트 | rooms:photos | RoomPhotosView(DetailView) | rooms/room_photos.html |


