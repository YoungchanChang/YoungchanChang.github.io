---
layout: post
title:  ec2에 https적용하기
category: aws
tags: [aws, ec2, https]
comments: true
---

# https의 개념

### https의 필요성

- http는 암호화 되지 않은 방법으로 데이터를 전송하기 때문에 서버와 클라이언트가 주고받는 메시지를 쉽게 볼 수 있다.

- 네트워크에서 데이터를 전달하는 데이터 전송 단위를 패킷이라고 한다. [와이어샤크](https://wireshark.kr.uptodown.com/windows)라는 패킷 분석 툴을 통해 내 홈페이지에 주소를 입력해 보면 데이터가 그대로 보이는 것을 알 수 있다.

- 메시지 전송과정에서 암호화한 것이 https이다.

### https과 ssl

- 통신은 여러개의 계층으로 이루어진다. 택배를 보낼 때, 택배보내는 회사 주소, 우리 집주소를 적듯이 통신은 여러 계층으로 이루어진다.

- https는 ssl이라는 통신방법 위에 동작하는 서비스 중에 하나이다.

- 사진 

> 내가 상점에서 물건을 구매하려고 할 때, 이 물건에 대해서 정부가 보증을 한다면 믿고 살 수 있을 것이다.  
> 마찬가지로 내가 특정 사이트에 접속할 때, 제 3자가 보증해준다면 안전하게 접속할 수 있을 것이다.

- SSL 인증서는 클라이언트와 서버간의 통신을 제 3자가 보증해주는 전자화된 문서이다.


# 공개키

- SSL 통신 방식을 이해하기 위해서는 공개키, 디지털 서명 방식을 이해하는 것이 필수이다.

### 공개키 암호화 방식 쉽게 비유해보기

> 해당 비유는 공개키가 이해가 되지 않아서 필자가 개인적으로 생각한 비유이다. 참조만 하기를 바란다.

- 아래는 갑돌이와 을순이가 안전하게 돈거래를 하는 방식이다.

1. 갑돌이는 금고와 열쇠를 갖고 있다. (* 단, 이 금고는 한 번 닫으면 갑돌이의 열쇠로 밖에 열 수 없다.)
2. 갑돌이는 을순이에게 금고를 전달한다.
3. 을순이는 금고에 돈을 넣는다.
4. 을순이는 갑돌이에게 금고를 전달한다.
5. 갑돌이는 받은 금고를 자신의 키로 연다.
6. 만약 도둑이 을순이의 금고를 훔쳤다고 해도 갑돌이의 열쇠가 없어서 금고문을 열지 못한다.

### 공개키 방식 다시 바라보기

- 여기서 금고는 공개키이고 비밀키는 열쇠이다. 

1. 갑돌이는 공개키와 비밀키를 두 개 갖고있다.(비밀키를 모르면 공개키로 암호화된 정보를 해독할 수 없다)
2. 갑돌이는 을순이에게 공개키를 전달한다.
3. 을순이는 공개키로 메시지를 암호화한다.
4. 을순이는 암호화된 메시지를 갑돌이에게 보낸다.
5. 갑돌이는 을순이에게 받은 암호화된 메시지를 자신의 사설키로 해독한다.
6. 만약 제 3자가 을순이의 암호화된 메시지를 훔쳤다고 해도 사설키가 없으므로 암호를 해독하지 못한다.

- 금고(공개키)와 열쇠(사설키) 비유는 "열쇠(사설키)가 없으면 다른 사람이 훔쳐가도 메시지를 해독할 수 없다."는 점에서 공개키와 사설키 비유와 같다.

- 그러나, 열쇠는 어떤 메시지도 담을 수 없지만 사설키는 메시지를 암호화 할 수 있다는 점에서 다르다. 사설키로 암호화한 메시지는 비공개키로 해독할 수 있고, 공개키로 암호화 한 메시지는 비공개키로 해독할 수 있다.

### 디지털 서명 방식

1. 내 비공개키로 정보를 암호화 한 후에 정보를 상대방에게 전송한다.
2. 데이터를 받은 사람은 공개키로 암호화된 정보를 해독한다.
3. 받은 사람은 보낸 사람의 메시지를 확인할 수 있다.
4. 암호화된 정보를 훔친 사람은 공개키로 해독할 수 있다. 그러나 메시지를 다시 암호화 할 수 없다.
5. 따라서, 비공개키로 암호화된 정보는 누가 메시지를 보냈는지 확인하는 용도로 쓰인다.


# SSL

### SSL의 동작 순서

- SSL 인증서를 통해 통신하는 방법은 다음과 같다.
	1. 서버 운영자는 인증서를 받아놓는다.
	2. 클라이언트가 서버에 접속하면 서버는 클라이언트에게 이 인증서 정보를 전달한다.
	3. 클라이언트는 서버에게서 받은 인증서 정보가 신뢰할 수 있는지 검증한다.

1. 서버는 CA(인증기관)으로부터 인증서를 구입한다.

2. 인증기관은 사설키로 암호화해서 서버용 인증서를 보낸다.

3. 클라이언트가 서버에 접속을 요청하면 서버는 인증서를 제공한다.

4. 클라이언트의 브라우저는 인증서를 발급한 인증기관이 자신의 CA리스트에 있는지 확인한다.

5. 인증기관이 맞다면 CA의 공개키로 인증서를 복호화한다.
	- CA공개키로 복호화 한다는 것은 인증기관에서 사설키로 암호화된 것임을 의미한다.


### SSL 통신 과정 실제로 살펴보기

- three hand-shake

# https EC2에 적용하기


# 참조

[윈도우에서 푸티를 통해 접속하기](https://opentutorials.org/course/228/4894)
[vscode에서 EC2파일 수정하기](https://snowdeer.github.io/tips/2018/02/20/editing-files-on-aws-using-vscode/)