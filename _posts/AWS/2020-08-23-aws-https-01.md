---
layout: post
title:  ec2에 https적용하기 - 01. https의 개념
category: aws
tags: [aws, ec2, https]
comments: true
---

# https의 개념

### https의 필요성

- http는 암호화 되지 않은 방법으로 데이터를 전송하기 때문에 서버와 클라이언트가 주고받는 메시지를 쉽게 볼 수 있다.

- 네트워크에서 데이터를 전달하는 데이터 전송 단위를 패킷이라고 한다. [와이어샤크](https://wireshark.kr.uptodown.com/windows)라는 패킷 분석 툴을 통해 내 홈페이지에 주소를 입력해 보면 데이터가 그대로 보이는 것을 알 수 있다.

<center>
<figure>
<img src="https://imgur.com/bJNbf1R.png" alt="views">
<figcaption>내가 전달하려고 하는 데이터를 규칙에 맞춰 겹겹이 쌓아서 보낸다.</figcaption>
</figure>
</center>

- 메시지 전송과정에서 암호화한 것이 https이다.

### https과 ssl

- 통신은 데이터를 여러 계층으로 감싸는 것에서 시작한다.

- 택배를 예로 들면, 1. 택배 내용물 2. 택배 상자 3. 우리집 주소와 보내는 주소 4. 보내는 회사 등으로 내용물을 감싸서 상대방에게 보내게 된다. 마찬가지로 데이터도 여러 계층으로 데이터를 감싸서 상대방에게 보내게 된다.

<center>
<figure>
<img src="https://i.imgur.com/NpCxkDB.png" alt="views">
<figcaption>내가 전달하려고 하는 데이터를 규칙에 맞춰 겹겹이 쌓아서 보낸다.</figcaption>
</figure>
</center>

- https는 위 사진의 1층(Application)과 2층(Transport) 사이에 ssl이라는 계층을 추가한 통신 방법이다.

<center>
<figure>
<img src="https://i.imgur.com/itfveiq.png" alt="views">
<figcaption>https는 데이터를 SSL계층을 통해 감쌌다</figcaption>
</figure>
</center>


### SSL이란?

> 내가 상점에서 물건을 구매하려고 할 때, 이 물건에 대해서 정부가 보증을 한다면 믿고 살 수 있을 것이다.  
> 마찬가지로 내가 특정 사이트에 접속할 때, 제 3자가 보증해준다면 안전하게 접속할 수 있을 것이다.

- SSL 인증서는 클라이언트와 서버간의 통신을 제 3자가 보증해주는 전자화된 문서이다.

- SSL 인증서를 통해 통신하는 방법은 다음과 같다.
	1. 서버 운영자는 인증서를 받아놓는다.
	2. 클라이언트가 서버에 접속하면 서버는 클라이언트에게 이 인증서 정보를 전달한다.
	3. 클라이언트는 서버에게서 받은 인증서 정보가 신뢰할 수 있는지 검증한다.

# 대칭키와 공개키

- SSL 통신 방식을 이해하기 위해서는 대칭키, 공개키, 디지털 서명 방식을 이해하는 것이 필수이다.

### 대칭키

- 대칭키는 동일한 키로 암호화와 복호화를 할 수 있는 암호화 기법이다.

- 암호화를 할 때 1234를 입력하면 복호화를 할 때 1234를 넣는 기법이다.

### 공개키 암호화 방식 쉽게 비유해보기

> 해당 비유는 공개키가 이해가 되지 않아서 필자가 개인적으로 생각한 비유이다. 참조만 하기를 바란다.

- 아래는 갑돌이와 을순이가 안전하게 돈거래를 하는 방식이다.

1. 갑돌이는 금고와 열쇠를 갖고 있다. (* 단, 이 금고는 한 번 닫으면 갑돌이의 열쇠로 밖에 열 수 없다.)
2. 갑돌이는 을순이에게 금고를 전달한다.
3. 을순이는 금고에 돈을 넣는다.
4. 을순이는 갑돌이에게 금고를 전달한다.
5. 갑돌이는 받은 금고를 자신의 키로 연다.
6. 만약 도둑이 을순이의 금고를 훔쳤다고 해도 갑돌이의 열쇠가 없어서 금고문을 열지 못한다.

### 공개키 방식 다시 바라보기

- 여기서 금고는 공개키이고 비밀키는 열쇠이다. 

1. 갑돌이는 공개키와 비밀키를 두 개 갖고있다.(비밀키를 모르면 공개키로 암호화된 정보를 해독할 수 없다)
2. 갑돌이는 을순이에게 공개키를 전달한다.
3. 을순이는 공개키로 메시지를 암호화한다.
4. 을순이는 암호화된 메시지를 갑돌이에게 보낸다.
5. 갑돌이는 을순이에게 받은 암호화된 메시지를 자신의 사설키로 해독한다.
6. 만약 제 3자가 을순이의 암호화된 메시지를 훔쳤다고 해도 사설키가 없으므로 암호를 해독하지 못한다.

- 금고(공개키)와 열쇠(사설키) 비유는 "열쇠(사설키)가 없으면 다른 사람이 훔쳐가도 메시지를 해독할 수 없다."는 점에서 공개키와 사설키 비유와 같다.

- 그러나, 열쇠는 어떤 메시지도 담을 수 없지만 사설키는 메시지를 암호화 할 수 있다는 점에서 다르다. 사설키로 암호화한 메시지는 비공개키로 해독할 수 있고, 공개키로 암호화 한 메시지는 비공개키로 해독할 수 있다.

### 디지털 서명 방식

1.철수는 메시지를 해쉬함수를 통해 해쉬값 생성  
2.철수의 사설키로 해쉬값 암호화  
3.암호화된 해쉬값을 대칭키로 암호화 - 전자서명 생성  
4.철수는 그냥 메시지와 전자서명을 대칭키로 암호화하여 암호문 생성  
5.영희의 공개키를 통해 철수의 대칭키를 암호화 - 전자봉투 생성  
	- 철수의 대칭키는 영희의 사설키로밖에 풀 수 없기 때문에 매우 안전  
6.철수는 해당 메시지를 영희에게 보낸다.

<center>
<figure>
<img src="https://imgur.com/0tSnwo8.png" alt="views">
<figcaption></figcaption>
</figure>
</center>


7.영희는 철수에게서 암호문과 암호문과 전자봉투를 받는다.  
8.전자봉투를 영희의 사설키로 해독하면 철수의 비밀키를 획득  
9.비밀키를 이용해 해독하면 철수의 전자서명값과 메시지가 나온다.  
10.철수의 전자서명을 철수의 공개키로 해독하면 해쉬값이 생성  
11.철수의 메시지를 해쉬함수를 통해 해쉬값 생성시킨 후 비교  

<center>
<figure>
<img src="https://imgur.com/ZlWBP16.png" alt="views">
<figcaption>그림 출처: 한빛아카데미, 정보보안개론 Chapter 09. 전자상거래</figcaption>
</figure>
</center>

# 참조
[CCENT/CCNA ICND1](http://www.yes24.com/Product/Goods/42422339?OzSrank=3)
